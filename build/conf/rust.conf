when ($OS_LINUX == "yes" && $ARCH_X86_64 == "yes") {
    RUST_ARCH=x86_64
    RUST_ABI=unknown-linux-gnu
}
elsewhen ($OS_DARWIN == "yes" && $ARCH_ARM64 == "yes") {
    # TODO
    RUST_ARCH=
    RUST_ABI=
}
elsewhen ($OS_DARWIN == "yes" && $ARCH_X86_64 == "yes") {
    # TODO
    RUST_ARCH=
    RUST_ABI=
}
RUST_TARGET=${RUST_ARCH}-${RUST_ABI}
RUST_STD=${RUST_RESOURCE_GLOBAL}/rust-std-$RUST_TARGET/lib/rustlib/$RUST_TARGET/lib

module RUST_PROGRAM {
    .DEFAULT_NAME_GENERATOR=DirName
    .ARGS_PARSER=Base
    .FINAL_TARGET=yes
    .STRUCT_CMD=yes
    .EXTS=.rs
    .NODE_TYPE=Program
    .PEERDIR_POLICY=as_build_from
    .CMD=${RUST_RESOURCE_GLOBAL}/rustc/bin/rustc -o $TARGET --edition 2024 ${input:"src/main.rs"} ${hide;input;glob:"src/**/*.rs"} -L ${RUST_STD}

    PEERDIR+=build/platform/rust
}
